import 'package:get/get.dart';
import 'package:easy_ussd/ussd_exporter.dart';

class USSDPlansControllerImpl extends USSDPlansController {
  USSDPlansUseCase uc = Get.find<USSDPlansUseCase>();

  @override
  void changeExpansion(USSDPlansGroupsModel item, bool isExpanded) {
    uc.changeExpansion(item.groupKey, !isExpanded);
    update();
  }

  @override
  bool isExpandedGroup(USSDPlansGroupsModel item) {
    return uc.isExpandedGroup(item.groupKey);
  }

  @override
  bool isFavoriteAction(ActionsUSSD action) {
    return uc.isFavorite(action);
  }

  @override
  void changeFavorite(ActionsUSSD action) {
    uc.changeFavorite(action);
    update([USSDController.UPDATE_ID_FAVORITE]);
  }

  @override
  List<USSDActionWidgetDomain> findFavorites() {
    List<String> favoriteKeys = uc.favoritesKeys();
    print(favoriteKeys);
    List<USSDActionWidgetDomain> allActions = USSDPlansGroupsModel.ACTIONS();

    List<USSDActionWidgetDomain> fav = [];

    favoriteKeys.forEach((key) {
      fav.add(
          allActions.firstWhere((action) => key == action.function.action.key));
    });

    return fav;
  }
}
